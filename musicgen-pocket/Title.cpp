#include "Title.h"
#include "Font3x5.h"

//PROGMEM const unsigned char logo[] = {0xc4, 0x44, 0x47, 0x01, 0x9f, 0x90, 0x0f, 0xe1, 0x4f, 0x90, 0x1f, 0x01, 0x1f, 0x10, 0x1c, 0x04,
//0x05, 0x05, 0x07, 0x00, 0x4f, 0xea, 0xe0, 0x7f, 0x00, 0x04, 0x03, 0x1c, 0x22, 0x32, 0x3c, 0x00};
//
PROGMEM const unsigned char logo[] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 
0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x88, 0x55, 0x37, 0x33, 0x76, 0x06, 0x23, 0x57, 
0x71, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x8E, 0x75, 0x42, 0x44, 0x45, 0x05, 0x54, 0x54, 
0x20, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x8A, 0x75, 0x42, 0x44, 0x65, 0x05, 0x54, 0x66, 
0x20, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0x8A, 0x55, 0x52, 0x45, 0x45, 0x06, 0x54, 0x54, 
0x20, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0xB8, 0x55, 0x52, 0x45, 0x45, 0x04, 0x54, 0x54, 
0x20, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
0xB8, 0x57, 0x37, 0x33, 0x75, 0x04, 0x23, 0x57, 
0x20, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

extern volatile byte nf;
extern volatile byte nf2;

Font3x5 font3x5 = Font3x5();

void Title::init(){
  cursor = 0;
  context.speed = 5;
}

SceneID Title::run(){
  if(arduboy.justPressed(A_BUTTON)){
    nf2 = (0x3f | 0x80) & 0x7f;
    switch(cursor){
      case 0: context.patternNo = 0; return STAY;
      case 1: context.patternNo = 1; return STAY;
      case 2: context.patternNo = 2; return STAY;
      case 3: context.patternNo = 3; return STAY;
      case 4: context.patternNo = 4; return STAY;
      case 5: context.patternNo = 5; return STAY;
    }
  }
  if(arduboy.justPressed(B_BUTTON)){
    nf = 0x3f;
  }
  if(arduboy.justPressed(UP_BUTTON)){
    if(cursor > 0){
      cursor --;
    }
  }
  if(arduboy.justPressed(DOWN_BUTTON)){
    if(cursor < 0){
      cursor ++;
    }
  }
  if(arduboy.justPressed(LEFT_BUTTON)){
    switch(cursor){
      case 0:
        if(context.speed > 3)context.speed --;
        break;
    }
  }
  if(arduboy.justPressed(RIGHT_BUTTON)){
   switch(cursor){
      case 0:
        if(context.speed < 10)context.speed ++;
        break;
   }
  }

  return STAY;
}

void Title::draw(){
  arduboy.clear();
  //arduboy.setCursor(0,0);
  //arduboy.print(F("MUSIC GEN POCKET"));
  arduboy.drawSlowXYBitmap(0,0,logo,128,8,1);
  arduboy.drawLine(0, 8, 0, 63, WHITE);
  arduboy.drawLine(73, 8, 127, 8, WHITE);
  arduboy.drawLine(127, 8, 127, 63, WHITE);
  arduboy.drawLine(0, 63, 127, 63, WHITE);

  font3x5.setCursor(5*2 ,10);
  font3x5.print(F("SPEED"));
  font3x5.setCursor(5*9, 10);
  font3x5.print(context.speed);

  font3x5.setCursor(2 ,10 + 9 * cursor);
  if(arduboy.everyXFrames(2)){
    font3x5.print(F("-"));
    arduboy.fillRect(5, 11 + 9*cursor, 3 , 5);
  }

  for(byte j = 0; j < 16; j++){
    if(context.modifier[context.track[0][context.trackPos]][j] != 0){
      arduboy.drawRect(j*8, 64 - context.pattern[context.track[0][context.trackPos]][j]*2 - 1, 8, 4);
    }else{
      arduboy.fillRect(j*8, 64 - context.pattern[context.track[0][context.trackPos]][j]*2, 8, 2);
    }
    arduboy.fillRect(j*8, 64 - context.pattern[context.track[1][context.trackPos]][j]*2, 8, 2);
  }
  arduboy.fillRect(context.seek*8, 8, 1, 63-8);

}
